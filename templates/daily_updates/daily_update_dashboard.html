{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h3 class="mb-3">Trainer-wise Daily Session Dashboard</h3>

    <!-- Filters -->
    <form method="get" class="mb-3 d-flex gap-2">
        <!-- Trainer Filter -->
        <select name="trainer" class="form-control">
            <option value="">-- Select Trainer --</option>
            {% for t in trainers %}
                <option value="{{ t.id }}" {% if selected_trainer == t.id|stringformat:"s" %}selected{% endif %}>
                    {{ t.user.username }}
                </option>
            {% endfor %}
        </select>

        <!-- Batch Filter -->
        <select name="batch" class="form-control">
            <option value="">-- Select Batch --</option>
            {% for b in batches %}
                <option value="{{ b.id }}" {% if selected_batch == b.id|stringformat:"s" %}selected{% endif %}>
                    {{ b.name }}
                </option>
            {% endfor %}
        </select>

        <!-- Month Filter -->
        <select name="month" class="form-control">
            <option value="">-- Select Month --</option>
            {% for value, name in month_options %}
                <option value="{{ value }}" {% if selected_month == value %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>

        <button type="submit" class="btn btn-secondary">Filter</button>
        <a href="{% url 'daily_update_dashboard' %}" class="btn btn-light">Reset</a>
    </form>

    <!-- Trainer Cards -->
    {% for item in trainer_updates %}
        {% if item.updates.exists %}
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <strong>{{ item.trainer.user.username }}</strong> - 
                    {% if item.trainer.batch %}
                        {{ item.trainer.batch.name }}
                    {% else %}
                        All Batches
                    {% endif %}
                </div>
                <div class="card-body">
                    <table class="table table-bordered table-hover mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th>Date</th>
                                <th>Batch</th>
                                <th>Topic Covered</th>
                                <th>Summary</th>
                                <th>Challenges</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for update in item.updates %}
                                <tr>
                                    <td>{{ update.date }}</td>
                                    <td>{{ update.batch.name }}</td>
                                    <td>{{ update.topic_covered|truncatechars:50 }}</td>
                                    <td>{{ update.summary|truncatechars:50 }}</td>
                                    <td>{{ update.challenges|truncatechars:50 }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% endif %}
    {% endfor %}
</div>
{% endblock %}
