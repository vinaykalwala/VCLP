{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h2>User List</h2>

    <!-- Summary Counts -->
    <div class="mb-3">
        <span class="badge bg-primary">Total Users: {{ total_users }}</span>
        <span class="badge bg-success">Active: {{ active_users }}</span>
        <span class="badge bg-danger">Inactive: {{ inactive_users }}</span>
        {% for role in role_counts %}
            <span class="badge bg-info text-dark">{{ role.role|title }}: {{ role.count }}</span>
        {% endfor %}
    </div>

    <form method="get" class="mb-3">
        <input type="text" name="q" placeholder="Search..." value="{{ request.GET.q }}">
        <select name="role">
            <option value="">All Roles</option>
            <option value="superuser" {% if request.GET.role|default:'' == 'superuser' %}selected{% endif %}>SuperUser</option>
            <option value="admin" {% if request.GET.role|default:'' == 'admin' %}selected{% endif %}>Administrator</option>
            <option value="trainer" {% if request.GET.role|default:'' == 'trainer' %}selected{% endif %}>Trainer</option>
            <option value="intern" {% if request.GET.role|default:'' == 'intern' %}selected{% endif %}>Intern</option>
        </select>
        <button class="btn btn-secondary" type="submit">Filter</button>
    </form>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Username</th>
                <th>Role</th>
                <th>Phone</th>
                <th>Password</th>
                <th>Active</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.get_role_display }}</td>
                <td>{{ user.phone }}</td>
                <td>
                    <input type="password" id="pwd-{{ user.id }}" value="{{ user.plain_password }}" readonly>
                    <button type="button" onclick="togglePassword({{ user.id }})">Show/Hide</button>
                </td>
                <td>{{ user.is_active }}</td>
                <td>
                    <a href="{% url 'user_update' user.pk %}" class="btn btn-warning btn-sm">Edit</a>
                    <a href="{% url 'user_delete' user.pk %}" class="btn btn-danger btn-sm">Delete</a>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="6">No users found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function togglePassword(id) {
    var input = document.getElementById('pwd-' + id);
    input.type = (input.type === "password") ? "text" : "password";
}
</script>
{% endblock %}
